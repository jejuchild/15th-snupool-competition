<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>스누풀 대회 전광판</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; background:#0a0a0a; color:#f3f4f6; }
    .card { @apply rounded-2xl bg-neutral-900/70 shadow-xl border border-neutral-700; }
    .btn { @apply inline-flex items-center justify-center px-3 py-2 rounded-xl bg-neutral-700 hover:bg-neutral-600 transition; }
    .tab { @apply px-4 py-2 rounded-xl cursor-pointer; }
    .tab-active { @apply bg-neutral-700; }
    .list-scroll { height: calc(100vh - 220px); }
    .mono { font-variant-numeric: tabular-nums; }

    /* 전체화면에선 뷰어만 남기고 나머지 숨김 */
    body.fs #topbar, body.fs #sidebar { display:none; }
    body.fs #layout { grid-template-columns: 1fr !important; }
    body.fs #viewerCard { @apply col-span-12; }
  </style>
</head>
<body>
  <div id="app" class="p-4 max-w-7xl mx-auto">
    <header id="topbar" class="flex items-center justify-between gap-4 mb-4">
      <h1 class="text-2xl font-bold">제15회 스누풀대회 전광판</h1>
      <div class="flex gap-2">
        <button id="tab-bracket" class="tab tab-active">대진표</button>
        <button id="tab-results" class="tab">기록</button>
        <button id="fsBtn" class="btn ml-2" title="전체화면 전환">전체화면</button>
      </div>
    </header>

    <section id="layout" class="grid grid-cols-1 lg:grid-cols-12 gap-4">
      <aside id="sidebar" class="card lg:col-span-4 p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 id="list-title" class="font-semibold">경기</h2>
          <div class="text-sm text-neutral-400" id="updatedAt"></div>
        </div>
        <div id="searchWrap" class="mb-2">
          <input id="search" type="text" placeholder="경기번호/종목명 검색" class="w-full px-3 py-2 rounded-xl bg-neutral-800 border border-neutral-700" />
        </div>
        <ul id="eventList" class="list-scroll overflow-y-auto divide-y divide-neutral-800"></ul>
      </aside>

      <main id="viewerCard" class="lg:col-span-8 card p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <button id="prevBtn" class="btn" title="이전(←)">←</button>
            <button id="nextBtn" class="btn" title="다음(→)">→</button>
          </div>
          <div class="text-sm text-neutral-400">전체화면에서 ← → 키 이동 / ESC 종료</div>
        </div>
        <div id="viewer"></div>
      </main>
    </section>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzMNzD5i5TdSyBAB3LwlRj_cu1wx8ZTnFEmevs5ubM41D2Bh1rDhVgRTArG1dxirwzZNA/exec";
    const AUTO_REFRESH_MS = 15000;

    function isFS(){ return !!document.fullscreenElement; }
    function enterFS(){ if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen(); }
    function exitFS(){ if (document.exitFullscreen) document.exitFullscreen(); }
    function updateFSUI(){
      const arrowsVisible = isFS();
      document.getElementById('prevBtn').onclick = ()=>{ if (isFS()) move(-1); };
    document.getElementById('nextBtn').onclick = ()=>{ if (isFS()) move(1); };
    document.getElementById('fsBtn').onclick = ()=>{ isFS() ? exitFS() : enterFS(); };
    document.getElementById('tab-bracket').onclick = ()=>{ state.page=0; rebuild('bracket'); };
    document.getElementById('tab-results').onclick = ()=>{ state.page=0; rebuild('results'); };
    updateFSUI();

    fetchAll();
    setInterval(fetchAll, AUTO_REFRESH_MS);
  </script>
</body>
</html>
